<!doctype html>
<html>

<head>
  <script>
    document.write('<meta charset="UTF-8">'); // Ini agar tidak error saat load awal
    fetch('/components/head.html')
      .then(response => response.text())
      .then(html => {
        document.head.innerHTML += html;
      })
      .catch(err => console.error('Gagal memuat head:', err));
  </script>
<!-- TABCONTENT -->
<script src="/tabcontent.js" type="text/javascript"></script>
<link href="/tabcontent.css" rel="stylesheet" type="text/css" />

<title>Galeri Foto</title>
</head>
<!-- OUTER-WRAPPER BEGIN -->
<div id="outer-wrapper">

	<a name="top"></a>

	<!-- HEADER PAROKI -->
	<!-- ======================================================================= -->
		<!-- ======================================================================= -->
	<div class="divheaderparoki">
		<a href="/"><img src="/img/header-logo-1.png" style="border:0; width: 100%"></a>
	</div>

<!-- ============================================ -->
<!-- <body onload="menusetup(0,'Galeri Foto')"> -->

<!-- ============================================ -->
<link rel="stylesheet" href="/style.css">

<script>
function togglemenudiv() {
    var div = document.getElementById("divmenu");
	var caret_up = document.getElementById("caret_up");
	var caret_down = document.getElementById("caret_down");

    //div.style.display = div.style.display == "none" ? "block" : "none";

	if(div.style.display == "none"){
		div.style.display = "block";
		caret_up.style.display = "inline";
		caret_down.style.display = "none";
	} else{
		div.style.display = "none";
		caret_up.style.display = "none";
		caret_down.style.display = "inline";
	}
}

function menusetup(flag,title){ //1 0, judul hlm
	//set menu visibility
	var div = document.getElementById("divmenu");
	var caret_up = document.getElementById("caret_up");
	var caret_down = document.getElementById("caret_down");

	if(flag == 1){
		div.style.display = "block";
		caret_up.style.display = "inline";
		caret_down.style.display = "none";
	} else{
		// div.style.display = "none";
		caret_up.style.display = "none";
		caret_down.style.display = "inline";
	}
	
	//set title
	var judul = document.getElementById('menubartitle');
	judul.textContent = title;
}
</script>

<!-- BEGIN LAYOUT -->
<!-- MENU BAR -->
<div id="divmenubar">
	<button id="btnmenu" onclick="togglemenudiv()">
		Menu &nbsp;
		<i id="caret_up" class="fa fa-caret-up" style="background:transparent; font-size:18px; color:white; display:none"></i>
		<i id="caret_down" class="fa fa-th" style="background:transparent; font-size:18px; color:white; display:none"></i> <!-- fa-th-large -->
	</button>
	<!-- <span id="txtflag">On</span> -->
	<span id="menubartitle">&nbsp;</span>
</div>

<!-- MENU DIV -->
  <div id="menu-container"></div>


<!-- <div class="divbtbar"> -->
	<!-- </div> -->

	</div> <!--div_menu-->
</div> <!-- clip for animation -->

<!-- ============================================ -->

<!-- PHOTO BOX : The Modal Window -->
<!-- ================================================================================================ -->
<div class="modalx" id="boxModal">
  
  <!-- Modal content -->
  <div class="modalx-content" style="color:black">

    <table cellpadding="0" cellspacing="0">
        <tr>
            <td style="padding:0 8px 0 8px;">
                <span id="boxModalTitle" style="float:left; margin-top:7px; margin-left:2px; font-family:ArchivoNarrow; font-size:12px; color:#777">&nbsp;</span>
                <div class="closex">&#215;</div>
            </td>
        </tr>
        <tr>
            <td style="text-align:center; padding: 0 8px 6px 8px;">
                <img id="boxModalImage" src="/img/smdtba-sharelogo.PNG" style="width:200px;border-radius:6px;">
            </td>
        </tr>
        <tr>
            <td style="text-align:center; padding:0 8px 0 8px;">
                <span id="boxModalText" ><em>&nbsp;</em></span>
            </td>
        </tr>
        <tr>
            <td style="text-align:center; padding:0 8px 15px 8px; font-family:ArchivoNarrow; font-size:12px; color:#8c6755">
                <span id="boxModalSubText" ><em>&nbsp;</em></span>
            </td>
        </tr>        
    </table>
  </div>

</div>
<!-- END OF LINTANG ABOUT MODAL WINDOW -->

<div style="padding:6px">

	<div style="margin-bottom: 1em"><table cellpadding="0" cellspacing="0"><tr><td class="tdiconheadline"><img class="iconheadline" src="/img/icon_camera.png" ></td><td style="padding-left:0.2em"><span class="headline_title">GALERI FOTO</span><br/><span class="headline_subtitle_green">KEGIATAN DI PAROKI SMDTBA</span></td></tr></table></div><style>

</style>

<ul class="tabs" data-persist="true">
    <li><a href="#2025">2025</a></li>
    <li><a href="#2024">2024</a></li>
</ul>

<div class="tabcontents"> 

	<div id="2025">
		<div id="galeri-container-2025">
    		<p>⏳Memuat galeri...</p>
		</div>			
	</div>

	<div id="2024">
		<div id="galeri-container-2024">
    		<p>⏳Memuat galeri...</p>
		</div>		
	</div>	
				
</div>				

	<div class="kontributor">
		<!--<img src="img/fotografer-1.png" style="width:50px; padding:5px"><br>-->
		<abu>Fotografer / Kontributor tetap :<br></abu>
		<b>Komsos Paroki Tulungagung</b>
	</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const apiURL = "https://opensheet.elk.sh/1Q0N_S10XVngXDReVapVhDh6ZwnoFcGxvbeUJjAxOZYI/galeri_foto";

  const warnaBulan = {
    "Januari": "#e0e9ee", "Februari": "#eee0e0", "Maret": "#e0e9ee",
    "April": "#eee0e0", "Mei": "#e1eee0", "Juni": "#e0e9ee",
    "Juli": "#eee0e0", "Agustus": "#e1eee0", "September": "#e0e9ee",
    "Oktober": "#eee0e0", "November": "#e1eee0", "Desember": "#e0e9ee"
  };
  // Fungsi bantu untuk mengubah nama bulan
function formatTanggalIndo(tanggalStr) {
  const bulanIndo = [
    "Januari", "Februari", "Maret", "April", "Mei", "Juni",
    "Juli", "Agustus", "September", "Oktober", "November", "Desember"
  ];

  const [tahun, bulan, tanggal] = tanggalStr.split("-"); // pisah "2024-12-24"
  const namaBulan = bulanIndo[parseInt(bulan, 10) - 1]; // ubah "12" jadi "Desember"
  return `${parseInt(tanggal, 10)} ${namaBulan} ${tahun}`;
}


  fetch(apiURL)
    .then(res => res.json())

    .then(data => {
      // Pisahkan data berdasarkan tahun
      const tahunData = { "2024": {}, "2025": {} };
	console.log (data)
      data.forEach(item => {
        const tahun = item.Tanggal?.slice(0, 4); // Ambil 4 digit pertama dari tanggal
        if (tahunData[tahun]) {
          const bulan = item.Bulan || "Lainnya";
          if (!tahunData[tahun][bulan]) tahunData[tahun][bulan] = [];
          tahunData[tahun][bulan].push(item);
        }
      });

      Object.entries(tahunData).forEach(([tahun, bulanMap]) => {
        const container = document.getElementById(`galeri-container-${tahun}`);
        if (!container) return;

        container.innerHTML = ""; // Bersihkan loader

        const bulanUrut = Object.keys(bulanMap).sort((a, b) => {
          const bulanIndo = ["Januari", "Februari", "Maret", "April", "Mei", "Juni",
                             "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
          return bulanIndo.indexOf(a) - bulanIndo.indexOf(b);
        });

        bulanUrut.forEach(bulan => {
          const details = document.createElement("details");
          const summary = document.createElement("summary");
          summary.innerHTML = `
  <b>
    <span style="color:#f5debb">${bulan} ${tahun}</span>
  </b>
  <span style="color:#191970"> (selengkapnya klik disini) </span> <br></br>
`;
          details.appendChild(summary);

          const galeriBulan = document.createElement("div");
          galeriBulan.className = "galeri-bulan";

          const containerDiv = document.createElement("div");
          containerDiv.className = "w3-container w3-card";
          containerDiv.style.padding = "14px 8px 8px 8px";
          containerDiv.style.borderRadius = "6px";
          containerDiv.style.backgroundColor = warnaBulan[bulan] || "#e0e0e0";

          const spanBulan = document.createElement("span");
          spanBulan.className = "bulan";
          spanBulan.innerHTML = ``;
          containerDiv.appendChild(spanBulan);

          bulanMap[bulan].forEach(item => {
            const panelDiv = document.createElement("div");
            panelDiv.className = "w3-panel w3-card";
            panelDiv.style.cursor = "pointer";
            panelDiv.onclick = () => {
              window.open(item.Link, '_blank', 'noopener');
            };

            const table = document.createElement("table");
            table.cellPadding = "0";
            table.cellSpacing = "0";

            const tr = document.createElement("tr");

            const tdIcon = document.createElement("td");
            tdIcon.className = "tdicon";
            const img = document.createElement("img");
            img.className = "iconsquare";
            img.src = `/public/galeri/${item.Gambar}`;
            tdIcon.appendChild(img);

            const tdDesc = document.createElement("td");
            tdDesc.className = "tddesc";
            const spanDate = document.createElement("span");
            spanDate.className = "datefont";
            spanDate.innerHTML = `${formatTanggalIndo(item.Tanggal)}<br/>`;
            const spanKring = document.createElement("span");
            spanKring.className = "kring";
            spanKring.textContent = item.Judul;
            const spanGrey = document.createElement("span");
            spanGrey.className = "greyfont";
            spanGrey.innerHTML = `<br/>Foto: ${item.Foto}`;
            tdDesc.appendChild(spanDate);
            tdDesc.appendChild(spanKring);
            tdDesc.appendChild(spanGrey);

            tr.appendChild(tdIcon);
            tr.appendChild(tdDesc);
            table.appendChild(tr);
            panelDiv.appendChild(table);
            containerDiv.appendChild(panelDiv);
          });

          galeriBulan.appendChild(containerDiv);
          details.appendChild(galeriBulan);
          container.appendChild(details);
        });
      });
    })
    .catch(err => {
      console.error("Gagal mengambil data:", err);
    });
});
</script>

</div> 

<!-- ======================================================================= -->
<!-- ======================================================================= -->

<div id="footer-placeholder"></div>
<script>
  fetch('/components/footer.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('footer-placeholder').innerHTML = data;

      // Setelah footer dimuat, baru cari elemen-elemennya
      const aboutmodal = document.getElementById("aboutModal");
      const boxmodal = document.getElementById("boxModal");

      const span = document.querySelector("#aboutModal .close");
      if (span && aboutmodal) {
        span.onclick = function () {
          aboutmodal.style.display = "none";
        };
      }

      const spanx = document.querySelector("#boxModal .closex");
      if (spanx && boxmodal) {
        spanx.onclick = function () {
          boxmodal.style.display = "none";
        };
      }

      window.onclick = function(event) {
        if (event.target == aboutmodal) {
          aboutmodal.style.display = "none";
        }
        if (event.target == boxmodal) {
          boxmodal.style.display = "none";
        }
      }

      // Buat fungsi global agar bisa dipanggil dari tombol
      window.ShowAboutBox = function () {
        aboutmodal.style.display = "block";
      };

      window.ShowPhotoBox = function (txt, fotopath, title, subtxt) {
        document.getElementById("boxModalTitle").innerHTML = title;
        document.getElementById("boxModalImage").src = fotopath;
        document.getElementById("boxModalText").innerHTML = txt;
        document.getElementById("boxModalSubText").innerHTML = subtxt;
        boxmodal.style.display = "block";
      };
    })
    .catch(err => console.error("Gagal memuat footer:", err));
</script>

<!-- FOOTER END -->

<!-- ============================================ -->
  <script>
    fetch('/components/menu.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('menu-container').innerHTML = data;
      })
      .catch(error => console.error('Gagal memuat menu:', error));
  </script>			

</body>

</html>