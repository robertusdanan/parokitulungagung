<!doctype html>
<html>

<head>
  <script>
    document.write('<meta charset="UTF-8">'); // Ini agar tidak error saat load awal
    fetch('/components/head.html')
      .then(response => response.text())
      .then(html => {
        document.head.innerHTML += html;
      })
      .catch(err => console.error('Gagal memuat head:', err));
  </script>

<title>Wilayah, Stasi Lingkungan</title>

<!-- TABCONTENT -->
<script src="/tabcontent.js" type="text/javascript"></script>
<link href="/tabcontent.css" rel="stylesheet" type="text/css" />

</head>
<!-- OUTER-WRAPPER BEGIN -->
<div id="outer-wrapper">

	<a name="top"></a>

	<!-- HEADER PAROKI -->
	<!-- ======================================================================= -->
		<!-- ======================================================================= -->
	<div class="divheaderparoki">
		<a href="/"><img src="/img/header-logo-1.png" style="border:0; width: 100%"></a>
	</div>

<!-- ============================================ -->
<body onload="menusetup(0,'Wilayah, Stasi dan Lingkungan')">

<!-- ============================================ -->
<link rel="stylesheet" href="/style.css">

<script>
function togglemenudiv() {
    var div = document.getElementById("divmenu");
	var caret_up = document.getElementById("caret_up");
	var caret_down = document.getElementById("caret_down");

    //div.style.display = div.style.display == "none" ? "block" : "none";

	if(div.style.display == "none"){
		div.style.display = "block";
		caret_up.style.display = "inline";
		caret_down.style.display = "none";
	} else{
		div.style.display = "none";
		caret_up.style.display = "none";
		caret_down.style.display = "inline";
	}
}

function menusetup(flag,title){ //1 0, judul hlm
	//set menu visibility
	var div = document.getElementById("divmenu");
	var caret_up = document.getElementById("caret_up");
	var caret_down = document.getElementById("caret_down");

	if(flag == 1){
		div.style.display = "block";
		caret_up.style.display = "inline";
		caret_down.style.display = "none";
	} else{
		div.style.display = "none";
		caret_up.style.display = "none";
		caret_down.style.display = "inline";
	}
	
	//set title
	var judul = document.getElementById('menubartitle');
	judul.textContent = title;
}
</script>

<!-- BEGIN LAYOUT -->
<!-- MENU BAR -->
<div id="divmenubar">
	<button id="btnmenu" onclick="togglemenudiv()">
		Menu &nbsp;
		<i id="caret_up" class="fa fa-caret-up" style="background:transparent; font-size:18px; color:white; display:none"></i>
		<i id="caret_down" class="fa fa-th" style="background:transparent; font-size:18px; color:white; display:none"></i> <!-- fa-th-large -->
	</button>
	<!-- <span id="txtflag">On</span> -->
	<span id="menubartitle">&nbsp;</span>
</div>

<!-- MENU DIV -->
  <div id="menu-container"></div>
<!-- PHOTO BOX : The Modal Window -->
<!-- ================================================================================================ -->
<div class="modalx" id="boxModal">
  
  <!-- Modal content -->
  <div class="modalx-content" style="color:black">

    <table cellpadding="0" cellspacing="0">
        <tr>
            <td style="padding:0 8px 0 8px;">
                <span id="boxModalTitle" style="float:left; margin-top:7px; margin-left:2px; font-family:ArchivoNarrow; font-size:12px; color:#777">&nbsp;</span>
                <div class="closex">&#215;</div>
            </td>
        </tr>
        <tr>
            <td style="text-align:center; padding: 0 8px 6px 8px;">
                <img id="boxModalImage" src="/img/smdtba-sharelogo.png" style="width:200px;border-radius:6px;">
            </td>
        </tr>
        <tr>
            <td style="text-align:center; padding:0 8px 0 8px;">
                <span id="boxModalText" ><em>&nbsp;</em></span>
            </td>
        </tr>
        <tr>
            <td style="text-align:center; padding:0 8px 15px 8px; font-family:ArchivoNarrow; font-size:12px; color:#8c6755">
                <span id="boxModalSubText" ><em>&nbsp;</em></span>
            </td>
        </tr>        
    </table>
  </div>

</div>


<!-- END OF LINTANG ABOUT MODAL WINDOW -->


<div style="padding:6px">

	<div style="margin-bottom: 1em"><table cellpadding="0" cellspacing="0"><tr>
		<td class="tdiconheadline"><img class="iconheadline" src="/img/icon/icon_square_lingkungan.png" ></td>
		<td style="padding-left:0.2em"><span class="headline_title">WILAYAH, STASI DAN LINGKUNGAN</span><br/>
		<span class="headline_subtitle">3 WILAYAH, 4 STASI dan 13 LINGKUNGAN</span><br/>
		<div class="headline_ket">Berikut Pengurus Periode 2024-2027</div></td></tr></table>

<ul class="tabs" data-persist="true">
  <li><a href="#wil1">WIL 1</a></li>
  <li><a href="#wil2">WIL 2</a></li>
  <li><a href="#wil3">WIL 3</a></li>
  <li><a href="#sts">STASI</a></li>
  <li><a href="#pkkt">PKKT</a></li>
</ul>

<div class="tabcontents" style="box-shadow: 0 2px 4px rgba(0,0,0,0.08), 0 2px 6px rgba(0,0,0,0.08)">
  <div id="wil1"><div id="wilayah-1"><p>Memuat wilayah...</p></div></div>
  <div id="wil2"><div id="wilayah-2"><p>Memuat wilayah...</p></div></div>
  <div id="wil3"><div id="wilayah-3"><p>Memuat wilayah...</p></div></div>
  <div id="sts"><div id="stasi"><p>Memuat stasi...</p></div></div>
  <div id="pkkt"><div id="pkkt"><p>Memuat pkkt...</p></div></div>
</div>
<script>
const sheetUrl = 'https://opensheet.elk.sh/1Q0N_S10XVngXDReVapVhDh6ZwnoFcGxvbeUJjAxOZYI/daftar_wilayah';

function getFotoFromNama(nama) {
  // Hilangkan titik, ganti spasi lebih dari satu dengan tanda hubung
  return "/img/person/" + nama.trim().replace(/\./g, "").replace(/\s+/g, "-") + ".jpg";
}

function ShowPhotoBox(nama, src, bidang, posisi) {
  // Isi modal foto dengan data yang diberikan dan tampilkan modal
  document.getElementById("boxModalTitle").textContent = nama;
  document.getElementById("boxModalImage").src = src;
  document.getElementById("boxModalText").textContent = bidang || "";
  document.getElementById("boxModalSubText").textContent = posisi || "";
  document.getElementById("boxModal").style.display = "block";
}

function createCard(item, index) {
  const foto = getFotoFromNama(item.Ketua);
  const pkkt = item.PKKT?.trim();
  const lingkungan = item.Lingkungan?.trim();

  const lingkunganHtml = lingkungan ? `<div><b>${lingkungan}</b></div>` : "";

  return `
<div class="w3-panel w3-card" style="background-color: #fbe9d7; cursor:pointer;">
  <table cellpadding="0" cellspacing="0" style="width:100%">
    <tr>
      <td style="width:50px; vertical-align:top;">
        <img class="iconsquare" src="${foto}" style="width:40px;height:40px;border-radius:5px"
          onclick="ShowPhotoBox('${item.Ketua}', '${foto}', '${lingkungan || ''}', 'Ketua')" />
      </td>
      <td style="padding-left:10px">
        ${lingkunganHtml}
        <div>
          Ketua: 
          <a href="javascript:void(0)" 
             onclick="ShowPhotoBox('${item.Ketua}', '${foto}', '${lingkungan || ''}', 'Ketua')">
            <b>${item.Ketua}</b>
          </a>
        </div>
        ${pkkt ? `<div>PKKT: <span style="color:darkgreen;font-weight:bold">${pkkt}</span></div>` : ""}
      </td>
      <td style="width:20px;text-align:right;color:#888">${index + 1}</td>
    </tr>
  </table>
</div>

  `;
}


function renderWilayah(idContainer, data) {
  if (data.length === 0) {
    document.getElementById(idContainer).innerHTML = "<p>Tidak ada data.</p>";
    return;
  }

  const namaWilayah = data[0].Wilayah;
  const koordinator = data[0].Koordinator?.trim();
  const fotoKoordinator = koordinator ? getFotoFromNama(koordinator) : null;

  const header = `
<div class="w3-container w3-card w3-pale-yellow" style="padding:10px; margin-bottom:10px; display: flex; justify-content: space-between; align-items: center;">
  <div>
    <h3 style="margin:0">${namaWilayah}</h3>
    ${koordinator ? `<p style="margin:0">
      Koordinator: 
      <a href="javascript:void(0)" 
         onclick="ShowPhotoBox('${koordinator}', '${fotoKoordinator}', '${namaWilayah}', 'Koordinator')">
        <b>${koordinator}</b>
      </a>
    </p>` : ""}
  </div>
  ${fotoKoordinator ? `<img src="${fotoKoordinator}" style="width:40px; height:40px; border-radius:5px; object-fit: cover;" 
        onclick="ShowPhotoBox('${koordinator}', '${fotoKoordinator}', '${namaWilayah}', 'Koordinator')">` : ""}
</div>
  `;

  const cards = data.map((item, i) => createCard(item, i)).join("");
  document.getElementById(idContainer).innerHTML = header + cards;
}




fetch(sheetUrl)
  .then(res => res.json())
  .then(data => {
    renderWilayah("wilayah-1", data.filter(d => d.Wilayah === "Wilayah 1"));
    renderWilayah("wilayah-2", data.filter(d => d.Wilayah === "Wilayah 2"));
    renderWilayah("wilayah-3", data.filter(d => d.Wilayah === "Wilayah 3"));
    renderWilayah("stasi",      data.filter(d => d.Wilayah === "Stasi"));
	renderWilayah("pkkt",       data.filter(d => d.Wilayah === "PKKT"));
  })
  .catch(err => {
    console.error("Gagal memuat data:", err);
    document.getElementById("wilayah-1").innerHTML = "<p>Gagal memuat data.</p>";
  });
</script>

</div>			

<script>
function RefreshFrame(idframe) {
	document.getElementById(idframe).src = document.getElementById(idframe).src;
}

</script>	

<div id="footer-placeholder"></div>
<script>
  fetch('/components/footer.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('footer-placeholder').innerHTML = data;

      // Setelah footer dimuat, baru cari elemen-elemennya
      const aboutmodal = document.getElementById("aboutModal");
      const boxmodal = document.getElementById("boxModal");

      const span = document.querySelector("#aboutModal .close");
      if (span && aboutmodal) {
        span.onclick = function () {
          aboutmodal.style.display = "none";
        };
      }

      const spanx = document.querySelector("#boxModal .closex");
      if (spanx && boxmodal) {
        spanx.onclick = function () {
          boxmodal.style.display = "none";
        };
      }

      window.onclick = function(event) {
        if (event.target == aboutmodal) {
          aboutmodal.style.display = "none";
        }
        if (event.target == boxmodal) {
          boxmodal.style.display = "none";
        }
      }

      // Buat fungsi global agar bisa dipanggil dari tombol
      window.ShowAboutBox = function () {
        aboutmodal.style.display = "block";
      };

      window.ShowPhotoBox = function (txt, fotopath, title, subtxt) {
        document.getElementById("boxModalTitle").innerHTML = title;
        document.getElementById("boxModalImage").src = fotopath;
        document.getElementById("boxModalText").innerHTML = txt;
        document.getElementById("boxModalSubText").innerHTML = subtxt;
        boxmodal.style.display = "block";
      };
    })
    .catch(err => console.error("Gagal memuat footer:", err));
</script>

<!-- FOOTER END -->

<!-- ============================================ -->
  <script>
    fetch('/components/menu.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('menu-container').innerHTML = data;
      })
      .catch(error => console.error('Gagal memuat menu:', error));
  </script>


															
</body>

</html>